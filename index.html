<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pi Bot</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #status { font-weight: bold; font-size: 1.2em; margin-top: 10px; color: green; }
    #countdown { font-size: 1.4em; color: #005500; }
    #stopBtn {
      margin-top: 20px;
      padding: 10px 16px;
      font-size: 1em;
      background-color: #d9534f;
      color: white;
      border: none;
      border-radius: 4px;
      display: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Pi Bot</h2>
  <p><strong>Unlock Time:</strong> <span id="target-time"></span></p>
  <p><strong>Countdown:</strong> <span id="countdown"></span></p>
  <p id="status">Authenticating...</p>
  <button id="stopBtn" onclick="stopRetry()">Stop Retry</button>

  <script>
    const bitgetAddress = "MDFNWH6ZFJVHJDLBMNOUT35X4EEKQVJAO3ZDL4NL7VQJLC4PJOQFWAAAAAAEJJJMOUSDC";
    const piAmount = "2800";
    const unlockTime = new Date("2025-04-20T18:30:04Z").getTime();

    let sendInterval = null;

    document.getElementById("target-time").innerText = new Date(unlockTime).toLocaleString();

    window.Pi.init({ version: "2.0", sandbox: false });

    window.Pi.authenticate(["username", "payments"], onAuthSuccess, onAuthFailure);

    function onAuthSuccess(auth) {
      document.getElementById("status").innerText = "Authenticated. Waiting...";
      const interval = setInterval(() => {
        const now = Date.now();
        const diff = unlockTime - now;

        if (diff <= 0) {
          clearInterval(interval);
          document.getElementById("countdown").innerText = `0h 0m 0s`;
          attemptSendLoop();
        } else {
          const hrs = Math.floor(diff / 3600000);
          const mins = Math.floor((diff % 3600000) / 60000);
          const secs = Math.floor((diff % 60000) / 1000);
          document.getElementById("countdown").innerText = `${hrs}h ${mins}m ${secs}s`;
        }
      }, 500);
    }

    function onAuthFailure(error) {
      document.getElementById("status").innerText = "Auth failed: " + error;
    }

    function attemptSendLoop() {
      document.getElementById("status").innerText = "Unlock reached. Attempting to send Pi...";
      document.getElementById("stopBtn").style.display = "inline-block";

      sendInterval = setInterval(() => {
        window.Pi.createPayment({
          amount: piAmount,
          memo: "Auto-send to Bitget",
          to: bitgetAddress
        }).then((payment) => {
          clearInterval(sendInterval);
          document.getElementById("status").innerText = "Success! Tx ID: " + payment.identifier;
          document.getElementById("stopBtn").style.display = "none";
        }).catch((err) => {
          console.log("Retrying... Reason:", err.message);
          document.getElementById("status").innerText = "Retrying... " + err.message;
        });
      }, 1000);
    }

    function stopRetry() {
      if (sendInterval) {
        clearInterval(sendInterval);
        sendInterval = null;
        document.getElementById("status").innerText = "Retry loop stopped manually.";
        document.getElementById("stopBtn").style.display = "none";
      }
    }
  </script>
</body>
</html>
