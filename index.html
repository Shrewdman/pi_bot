<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pi Bot (Test Mode)</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #status { font-weight: bold; font-size: 1.2em; margin-top: 10px; }
    #countdown { font-size: 1.5em; color: #008000; }
  </style>
</head>
<body>
  <h2>Pi Bot (Test Mode)</h2>
  <p><strong>Simulated Unlock Time:</strong> <span id="target-time"></span></p>
  <p><strong>Countdown:</strong> <span id="countdown"></span></p>
  <p id="status">Authenticating (sandbox)...</p>

  <script>
    const bitgetAddress = "Mxxxxxxxxxxxxxxxxxxxxx"; // Test address
    const piAmount = "1"; // Fake test amount
    const unlockTime = Date.now() + 2 * 60 * 1000; // 2 minutes from now

    document.getElementById("target-time").innerText = new Date(unlockTime).toLocaleString();

    // Initialize Pi SDK in sandbox (test) mode
    window.Pi.init({ version: "2.0", sandbox: true });

    window.Pi.authenticate(["username", "payments"], onAuthSuccess, onAuthFailure);

    function onAuthSuccess(auth) {
      document.getElementById("status").innerText = "Authenticated (test). Waiting for simulated unlock...";
      const interval = setInterval(() => {
        const now = Date.now();
        const diff = unlockTime - now;

        if (diff <= 0) {
          clearInterval(interval);
          document.getElementById("countdown").innerText = `0h 0m 0s`;
          sendPi();
        } else {
          const hrs = Math.floor(diff / 3600000);
          const mins = Math.floor((diff % 3600000) / 60000);
          const secs = Math.floor((diff % 60000) / 1000);
          document.getElementById("countdown").innerText = `${hrs}h ${mins}m ${secs}s`;
        }
      }, 500);
    }

    function onAuthFailure(error) {
      document.getElementById("status").innerText = "Auth failed: " + error;
    }

    function sendPi() {
      document.getElementById("status").innerText = "Simulated send (test mode)...";
      window.Pi.createPayment({
        amount: piAmount,
        memo: "Test auto send",
        to: bitgetAddress
      }).then((payment) => {
        document.getElementById("status").innerText = "Test Success! ID: " + payment.identifier;
        console.log("Test payment object:", payment);
      }).catch((err) => {
        document.getElementById("status").innerText = "Test error: " + err.message;
        console.error("Test error:", err);
      });
    }
  </script>
</body>
</html>
